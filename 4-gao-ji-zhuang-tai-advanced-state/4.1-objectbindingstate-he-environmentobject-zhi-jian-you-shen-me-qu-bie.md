# 4.1 @ObjectBinding，@State和@EnvironmentObject之间有什么区别？

## [What’s the difference between @ObjectBinding, @State, and @EnvironmentObject?](https://www.hackingwithswift.com/quick-start/swiftui)

## 1. 什么是 @State

**状态（State）** -- 在任何现代应用程序中都是不可避免的。但是对于SwiftUI，重要的是要记住:   
我们所有的**视图**都只是（它们的）**状态的函数** - 我们不会直接改变视图，而是**操纵状态并让它决定结果**。

SwiftUI 为我们提供了几种在应用程序中**`存储状态`**的方法，但是它们之间略有不同，为了正确使用框架（framework），理解它们的不同之处变得非常重要。

到目前为止，在我们所有的状态示例中，我们使用 **`@State`** 来创建这样的属性:

```swift
struct ContentView : View {
    @State var score = 0
    // more code
}
```

这段代码在视图中创建了一个属性，但它使用`@State`**`属性包装器（property wrapper）`**来请求 SwiftUI 来管理内存。这一点很重要: 我们所有的视图都是结构体（structs），这意味着它们不能被改变，如果我们不能在一场比赛中给一个 score 加1，那么这就不是一场比赛了。

所以，当我们通过 `@State` 生成一个属性时，我们将控制权交给了 SwiftUI，以致于只要视图存在，它就在内存中保持不变。当该状态发生变化时，SwiftUI 知道自动重新加载具有最新更改的视图，以便它可以反映其新信息。

**`@State`** 非常适合特定视图的简单属性，并且永远不会在该视图之外使用。因此通常最好将这些属性标记为 **`private`**，如下所示:

```swift
@State private var score = 0
```

这再次强化了这样一种观点，即这种状态是专门设计的，永远不会脱离它的视图。

## 2.什么是 @ObjectBinding

对于更复杂的属性 -- 如果你要使用可能具有多个属性和方法的自定义类型，或者可能跨多个视图共享，那么你应该使用 `@ObjectBinding`。

这与 `@State` 非常相似，除了现在我们使用外部引用类型而不是像 字符串或整数这样的简单本地属性。您仍然可以说你的视图取决于要更改的数据，除非您负责自己管理的数据-您需要创建类的实例，创建自己的属性，等等。

与 `@ObjectBinding` 一起使用的类型应该遵循 **`BindableObject`** 协议，该协议只有一个要求：您的类型必须实现某种类型的didchange属性，当视图的数据发生更改时通知视图。

这就是我的意思，当我说这是你负责管理自己的数据时——当你在绑定对象上设置一个属性时，你就可以决定是否应该强制视图刷新。你通常会的，但不是必须的。

可绑定的对象可以使用 `Combine` 框架中 `publisher`  通知其视图重要数据已经更改。如果可绑定对象碰巧有几个视图使用其数据，那么它将自动通知所有视图。

**警告**：当您使用 `publisher` 宣布您的对象已更改时，这必须在主线程上发生。

## 3.什么是 @EnvironmentObject

您已经了解了`@state`如何声明一个类型的简单属性，该类型在更改时自动导致视图更新，以及`@objectbinding`如何声明外部类型的属性，该属性在更改时可能会或可能不会导致视图更新。这两个都必须由您的视图设置，但是`@objectbinding`可能与其他视图共享。

还的第三种类型的属性可供使用，即`@EnvironmentObject`。这是一个通过应用程序本身可用于您的视图的值 -- 它是每个视图都可以读取的共享数据，因此，如果你的应用程序有一些重要的模型数据，所有视图都需要阅读，你可以把它从一个视图传递到另一个视图，或者把它放到每个视图都可以即时访问的环境中。

当您需要在应用程序周围传递大量数据时，可以将`@environmentobject`视为一种极大的便利。由于所有视图都指向同一模型，因此如果一个视图更改模型，则所有视图都会立即更新--不会有使应用程序的不同部分不同的风险。

## 4.总结差异

* 将`@State`用于属于单个视图的简单属性。 它们通常应标记为 `private`。
* 将`@ObjectBinding`用于可能属于多个视图的复杂属性。 无论何时使用引用类型，都应该使用`@ObjectBinding`。
* 将`@EnvironmentObject`用于在应用程序中其他位置创建的属性，例如共享数据。

在这三个中你会发现**`@ObjectBinding`**是最有用和最常用的，所以如果你不确定从哪里开始使用。

